{"version":3,"sources":["webpack://ringcentral-engage-voice-embeddable-mobile/./src/client/app/common.js","webpack://ringcentral-engage-voice-embeddable-mobile/./src/client/app/check-permission.js","webpack://ringcentral-engage-voice-embeddable-mobile/./src/client/app/event-handler.js","webpack://ringcentral-engage-voice-embeddable-mobile/./src/client/work.js"],"names":["wait","ms","Promise","resolve","setTimeout","waitUntilLoad","inited","window","cordova","plugins","iosrtc","console","log","loadScript","url","script","document","createElement","type","src","async","body","appendChild","checkPermission","registerGlobals","audioinput","checkMicrophonePermission","hasPermission","getMicrophonePermission","message","warn","postMessage","data","getCode","key","c","localStorage","getItem","setItem","login","callbackUri","rc","getUrl","authUrlDefaultRc","replace","defaultState","view","onEvent","e","debug","oAuthUri","location","href","handleEvent","JSON","parse","stringify","addEventListener","run"],"mappings":"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","file":"js/work.bundle.js","sourcesContent":["\nexport function wait (ms) {\n  return new Promise((resolve) => {\n    setTimeout(resolve, ms)\n  })\n}\n\nexport async function waitUntilLoad () {\n  let inited = false\n  while (!inited) {\n    if (window.cordova && window.cordova.plugins && window.cordova.plugins.iosrtc) {\n      inited = true\n    } else {\n      console.log('wait')\n      await wait(50)\n    }\n  }\n  return true\n}\n\nexport function loadScript (url) {\n  const script = document.createElement('script')\n  script.type = 'text/javascript'\n  script.src = 'app.js'\n  script.async = false\n  document.body.appendChild(script)\n}\n","\nexport function checkPermission () {\n  // First check whether we already have permission to access the microphone.\n  cordova.plugins.iosrtc.registerGlobals()\n  window.audioinput.checkMicrophonePermission((hasPermission) => {\n    if (hasPermission) {\n      console.log('We already have permission to record.')\n      // startCapture()\n    } else {\n      // Ask the user for permission to access the microphone\n      window.audioinput.getMicrophonePermission((hasPermission, message) => {\n        if (hasPermission) {\n          console.log('User granted us permission to record.')\n        } else {\n          console.warn('User denied permission to record.')\n        }\n      })\n    }\n  })\n}\n","/**\n * handle events\n */\n\nfunction postMessage (data) {\n  window.postMessage(data, '*')\n}\n\nfunction getCode () {\n  const key = 'rc-authcode'\n  const c = window.localStorage.getItem(key)\n  if (c) {\n    window.localStorage.setItem(key, '')\n    return c\n  } else {\n    return ''\n  }\n}\n\nfunction login () {\n  const c = getCode()\n  if (c) {\n    postMessage({\n      type: 'rc-ev-authorization-code',\n      callbackUri: `${window.rc.callbackUri}?code=${c}`\n    })\n  }\n}\n\nfunction getUrl () {\n  return window.rc.authUrlDefaultRc.replace(\n    window.rc.defaultState,\n    window.rc.view\n  )\n}\n\nfunction onEvent (e) {\n  const { data } = e\n  console.debug('got data from ev', data)\n  if (data) {\n    switch (data.type) {\n      case 'rc-ev-loginPopup':\n        // get login oAuthUri from widget\n        console.log('rc-ev-loginPopup:', data.oAuthUri)\n        window.location.href = getUrl()\n        //  window.open(data.oAuthUri); // open oauth uri to login\n        break\n      case 'rc-ev-init':\n        login()\n        postMessage({\n          type: 'rc-init-rtc'\n        })\n        break\n      default:\n        break\n    }\n  }\n}\n\nexport function handleEvent () {\n  window.rc = JSON.parse(\n    window.localStorage.getItem('rc-data-ref', JSON.stringify(window.rc))\n  )\n  // window.top = window\n  // window.parent = window\n  window.addEventListener('message', onEvent)\n}\n","\n/**\n * replace app default script\n */\n\nimport { waitUntilLoad, loadScript } from './app/common'\nimport { checkPermission } from './app/check-permission'\nimport { handleEvent } from './app/event-handler'\n\nasync function run () {\n  await waitUntilLoad()\n  checkPermission()\n  loadScript('https://webrtc.github.io/adapter/adapter-latest.js')\n  loadScript('app.js')\n  handleEvent()\n}\n\nrun()\n"],"sourceRoot":""}